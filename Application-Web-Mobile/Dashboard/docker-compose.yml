version:  '3'
services:
    server:
        build: ./server/
        ports: 
            - "8080:8080"
        restart: always
        expose:
            - "8080"
        networks:
            - server-db
            - server-client
    db:
        image: postgres:latest
        restart: always
        volumes:
            - db-data:/var/lib/postgres/data
            - ./database/schema.sql:/docker-entrypoint-initdb.d/schema.sql
        environment:
            POSTGRES_DB: dashboard
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: password
            PGDATA: /var/lib/postgresql/data
        networks:
            - server-db
            - db-pgadmin
        ports:
            - "5432:5432"
    client:
        build: ./client/
        ports:
            - "80:8080"
        restart: always
        expose:
            - "8080"
        networks:
            - server-client
    pgadmin:
        image: dpage/pgadmin4:4.18
        restart: always
        environment:
            PGADMIN_DEFAULT_EMAIL: tony-zhou6@hotmail.fr
            PGADMIN_DEFAULT_PASSWORD: admin
            PGADMIN_LIST_PORT: 80
        ports:
            - "8100:80"
        expose:
            - "80"
        volumes:
            - pgadmin-data:/var/lib/pgadmin
        networks:
            - db-pgadmin
        
volumes:
    db-data:
    pgadmin-data:

networks:
    server-db:
    server-client:
    db-pgadmin: